# 考研辅助全栈平台 - PRD & Roadmap

## 1. 产品需求文档 (PRD)

### 1.1 产品定位
一个基于 EVA 绫波丽 (Rei Ayanami) 主题美学的考研辅助与个人知识管理全栈平台。结合了任务管理、番茄钟、知识库、资源站和每日留痕功能，旨在为考研党提供一个沉浸式、高效率、极简高级的数字花园。

### 1.2 核心用户群体
- 考研备考学生（408 + 数一 + 英一 + 政治）
- 需要高度专注和时间管理的用户
- 喜欢极简、二次元机甲美学（EVA）的极客

### 1.3 现有功能总结
1. **任务与计划 (Tasks)**: 包含日历视图、时间轴、甘特图（日/周切换）、番茄钟/倒计时、全屏沉浸模式、重复任务设定。
2. **每日留痕 (Blog)**: 记录每日学习心得，支持 Markdown 编写、标签过滤、分页、沉浸式编辑与预览。
3. **知识库 (Notes)**: 树状目录管理，Markdown 渲染，集成 Gemini AI 助手进行文档问答。
4. **资源站 (Resources)**: 资料卡片管理，支持一键生成测试题。
5. **练功房 (Quiz)**: 基于资源站资料生成的 AI 测试题库。
6. **全局时钟 (Global Clock)**: 极简翻页时钟，支持全屏。

### 1.4 新增完善功能 (至少5个)
1. **考研倒计时与进度大盘 (Dashboard)**: 首页直观展示距离考研的倒计时天数、今日任务完成率、各科复习进度条（如数据结构、计网、操作系统、机组）。
2. **四科目进度与筛选 (Subjects)**: 任务、资源、练功房支持 408/数一/英一/政治筛选与科目统计。
3. **本地文件与目录上传 (Storage)**: 知识库和资源站支持选择本地目录批量导入，支持文件夹新建、移动、重命名与回收站。
4. **学习状态统计与热力图 (Analytics)**: 记录每天的番茄钟专注时长和任务完成数量，在首页生成类似 GitHub 的提交热力图，直观展示学习状态。
5. **错题本与智能复习 (Spaced Repetition)**: 练功房做错的题目自动加入错题本，并根据艾宾浩斯记忆曲线（Spaced Repetition）在特定时间提醒复习。
6. **任务重新编辑与拖拽排序 (Task Management)**: 任务列表支持直接点击重新编辑（修改时间、时长、内容），并在时间轴视图中支持拖拽调整任务顺序。
7. **AI 助手体验优化**: 意图模式切换、上下文可控、多轮工作流、失败兜底、结构化输出模板。
8. **内置浏览器与视频播放**: 直接播放 B 站视频，资源卡片可绑定视频链接。
9. **一键导入计划 MD 文档**:
  - 新增“计划导入器”，支持上传周计划/月计划 Markdown。
  - 解析 `## 周次/月份`、`- [ ]` 任务条目、日期标签（如 `@2026-03-01`）。
  - 自动映射到任务系统：生成指定周期任务、优先级、标签与重复规则。
  - 导入前提供预览与冲突策略（跳过/覆盖/合并）。
10. **Tailscale 内网穿透接入**:
  - 桌面端增加“局域网访问”设置页，展示 Tailscale 节点状态与 MagicDNS 地址。
  - 支持通过 Tailnet 从手机/平板访问本地数字花园。
  - 增加安全约束：只允许已授权 Tailnet 设备 + 本地只读/读写权限切换。

---

## 2. 开发路线图 (Roadmap)

### Phase 1: 前端 UI 与交互完善 (当前阶段)
- [x] 确立 EVA 绫波丽主题美学（冷白、浅蓝、黑色、橙色点缀）。
- [x] 完善任务甘特图、番茄钟全屏、全局时钟。
- [x] 每日留痕分页与现代 Markdown 编辑器。
- [ ] 首页 Dashboard 重构：加入考研倒计时、进度条、热力图 UI。
- [ ] 任务列表加入“重新编辑”功能。
- [ ] 知识库/资源站加入目录上传与文件管理 UI。
- [ ] 资源站加入视频播放与科目筛选入口。

### Phase 2: 后端基础设施搭建 (Week 1-2)
- **技术栈**: Node.js + Express + TypeScript + Prisma (ORM) + PostgreSQL。
- **任务**:
  - 搭建 Express 服务器，配置 Vite 中间件实现全栈同构。
  - 设计数据库 Schema：User, Task, Post, Document, Quiz, StudySession。
  - 实现 RESTful API 路由：`/api/tasks`, `/api/posts`, `/api/documents`。
  - 集成 JWT 身份验证（可选，如果作为私人平台可简化）。
  - 计划导入器 v1：实现 Markdown AST 解析（remark），将周/月计划转为标准 Task DTO。

### Phase 3: 文件存储与 AI 深度集成 (Week 3-4)
- **文件存储**:
  - 集成 Multer 处理文件上传。
  - 对接云存储服务（S3/OSS），实现 PDF 和 Markdown 文件的上传、下载和预览链接生成。
- **AI 增强**:
  - 将 Gemini API 移至后端，保护 API Key。
  - 实现文档的向量化存储（使用 pgvector 或 Pinecone），让 AI 助手能够基于整个知识库进行 RAG（检索增强生成）问答，而不仅限于当前文档。
  - 导入计划冲突检测：同日期+同标题任务去重，生成导入报告（新增/跳过/冲突）。

### Phase 4: 核心业务逻辑闭环 (Week 5-6)
- **任务与专注**:
  - 将前端的任务状态、番茄钟记录同步到数据库的 `StudySession` 表。
  - 根据数据库数据动态生成首页的学习热力图和进度大盘。
- **错题本系统**:
  - 记录练功房的答题结果，实现错题本 API。
  - 编写定时任务（Cron Job）或在用户登录时计算今日需要复习的错题。

### Phase 5: 部署与优化 (Week 7)
- **部署方案**:
  - 数据库部署：Supabase 或 Neon (Serverless Postgres)。
  - 应用部署：Vercel (前端) + Render/Railway (后端)，或使用 Docker 容器化统一部署到 VPS。
- **性能优化**:
  - 配置 Redis 缓存高频查询（如首页统计数据）。
  - 优化前端打包体积，配置 CDN 加速静态资源。
  - 完善移动端 PWA 支持，实现离线访问和桌面图标。
  - Tailscale 接入 PoC：
    - 桌面端启动时检测 `tailscale status`。
    - 暴露本地服务到 Tailnet（仅 `100.x.x.x` 或 MagicDNS）。
    - 增加 PRD 安全检查项：ACL、设备过期策略、共享设备隔离。

---

## 3.1 计划导入 MD 功能方案（新增）

### 输入模板（MVP）
```md
# 2026-W10 周计划
## 本周目标
- [ ] 完成 408：操作系统第3章 @2026-03-02 #408 #high
- [ ] 数学真题一套 @2026-03-04 #math #medium
```

### 解析规则
- 标题识别周期：`Wxx` 视为周计划，`YYYY-MM` 视为月计划。
- 任务行识别：仅处理 `- [ ]` / `- [x]`。
- 元信息提取：`@日期`、`#标签`、`#high|#medium|#low`。
- 未标注日期任务默认落到导入周期首日。

### 输出与落库
- 生成任务草案列表 -> 用户确认 -> 批量写入任务表。
- 输出导入报告：总条数、成功数、冲突数、忽略项。

### 风险与约束
- 非结构化文档可读性高但解析稳定性较低；MVP 先限制模板。
- 首版不处理自然语言日期（如“下周三”），仅支持 ISO 日期。
