# 本地化桌面端与局域网 Web 模式架构设计

为了实现“文档存在自己电脑上”、“平板局域网访问”以及“接入 DeepSeek API 作为知识库助手”的需求，我们需要将当前的纯前端 Web 应用改造为**本地优先（Local-First）的桌面端应用**，并内嵌一个轻量级 Web 服务器。

## 1. 核心技术选型

推荐使用 **Tauri** (Rust + WebView) 或 **Electron** (Node.js + Chromium) 来打包现有的 React/Vite 项目。考虑到性能、包体积和安全性，**Tauri 是首选**。

- **前端**: React + Vite + Tailwind CSS (保持现状)
- **桌面端框架**: Tauri (v2 支持移动端，v1 非常成熟) - **Rust** 语言编写后端逻辑
- **后端/本地服务**: Rust (Tauri)
- **本地数据库**: SQLite (用于存储任务、留痕元数据、错题本)
- **文件存储**: 直接读写本地操作系统的文件系统（如 `~/Documents/EVA_Knowledge_Base`）
- **AI 引擎**: DeepSeek API (通过本地后端发起请求，避免跨域和密钥泄露)
- **向量数据库 (RAG)**: ChromaDB (本地运行) 或 SQLite-VSS (轻量级向量扩展)
- **内置浏览器/视频播放**: WebView2/Chromium 直接渲染 B 站与资源站视频内容

## 2. 架构设计图

```text
+---------------------------------------------------+
|                  EVA 考研辅助终端                 |
|                                                   |
|  +-----------------+         +-----------------+  |
|  |   桌面端 UI     |         |  局域网 Web UI  |  |
|  | (Tauri WebView) |         | (平板/手机访问) |  |
|  +--------+--------+         +--------+--------+  |
|           |                           |           |
|           v                           v           |
|  +---------------------------------------------+  |
|  |               本地核心服务层                |  |
|  |  (Rust 提供 API 和 WebSocket)               |  |
|  +--------+-----------------+------------------+  |
|           |                 |                  |  |
|           v                 v                  v  |
|  +----------------+ +----------------+ +-------+--+
|  | 本地文件系统   | | 本地 SQLite 库 | | DeepSeek |
|  | (PDF/Markdown) | | (任务/留痕/图谱| | API 接口 |
|  +----------------+ +----------------+ +----------+
+---------------------------------------------------+
```

## 3. Vibecoding 开发流程 (如何实现)

既然你对具体实现没有思路，我们将采用 **Vibecoding** (氛围编码/自然语言编程) 的模式：

1.  **Idea (想法)**: 你用自然语言描述需求（例如：“我要一个记录学习时长的功能”）。
2.  **Plan (拆解)**: AI 助手（我）将需求拆解为技术步骤（状态管理、UI 组件、数据库字段）。
3.  **Code (生成)**: AI 生成 React 组件 (前端) 和 Rust 命令 (后端)。
4.  **Verify (验证)**: 你运行代码，查看效果。
5.  **Iterate (迭代)**: 提出修改意见，循环优化。

**你不需要精通 Rust 或 C++，只需要会运行命令 (npm run dev / tauri dev) 即可。** 所有的底层复杂性由 Tauri 和 React 生态封装。

## 4. 改造步骤与你需要做的事

### 第一步：初始化 Tauri / Electron 环境
1. **安装 Tauri CLI**: `npm install -D @tauri-apps/cli`
2. **初始化**: `npx tauri init`，配置构建命令为 `npm run build`，产物目录为 `dist`。
3. **修改前端 API 调用**: 将原本直接在前端处理的数据（如 mock 数据），改为调用 Tauri 的 `invoke` 命令，与 Rust 后端通信。

### 第二步：实现本地文件系统管理 (知识库/资源站)
1. **定义本地工作区**: 在软件首次启动时，让用户选择一个本地文件夹作为“工作区”（Workspace）。
2. **读取目录树**: 编写 Rust 函数，递归读取工作区内的文件夹和 Markdown/PDF 文件，返回给前端渲染树状目录。
3. **文件操作**: 实现新建文件夹、重命名、移动、删除的本地 API。
4. **Markdown 读写**: 前端编辑器保存时，直接将内容写入本地的 `.md` 文件。
5. **目录上传**: 支持选择本地目录批量导入，自动解析并还原层级结构。
6. **资源站管理**: 资源库按树形目录+标签双维度组织，并支持一键转存到知识库。

### 第三步：搭建局域网 Web 服务 (平板访问)
1. **内嵌 Web Server**: 在 Tauri 的 Rust 后端中，集成 `axum` 或 `actix-web`，启动一个运行在 `0.0.0.0:3000` 的 HTTP 服务器。
2. **静态资源托管**: 将 Vite 打包后的 `dist` 目录作为静态资源托管。
3. **API 路由**: 将桌面端 UI 使用的 Tauri `invoke` 命令，封装成 RESTful API 或 WebSocket，供局域网内的 Web UI 调用。
4. **获取局域网 IP**: 在桌面端 UI 上显示本机的局域网 IP（如 `192.168.1.100:3000`），方便平板扫码或输入访问。

### 第四步：接入 DeepSeek API 与本地 RAG
1. **配置界面**: 在前端设置页增加 DeepSeek API Key 的输入框，并安全地保存在本地（如使用 Tauri 的 `tauri-plugin-store`）。
2. **文档向量化**:
   - 当用户在知识库中添加或修改 Markdown/PDF 时，后台触发向量化任务。
   - 使用轻量级的嵌入模型（如 `m3e-base` 或直接调用 DeepSeek 的 embedding 接口）将文本转为向量。
   - 存入本地的 SQLite-VSS 数据库。
3. **智能问答**:
   - 用户提问时，先在本地向量库中检索最相关的文档片段。
   - 将片段作为上下文（Context）拼接到 Prompt 中。
   - 调用 DeepSeek 的 Chat API 生成回答。

## 5. AI 助手体验优化（5 项必须改进）
1. **意图模式与任务引导**：提供“总结/检索/生成/计划/复盘”等模式，减少跳跃式回答。
2. **上下文可见与可控**：展示被引用的笔记片段与来源文件，可勾选启用/禁用上下文。
3. **多轮记忆与工作流**：支持跨问题的短期记忆，并在任务结束后自动清理会话。
4. **失败兜底与澄清建议**：当资料不足时给出明确原因与下一步补全建议。
5. **可执行结果格式化**：输出清单、时间表、复习卡片等固定结构，贴合备考场景。

## 6. 考研科目融入方案
- **科目层级**：总科目包含 408、数一、英一、政治；408 下细分为数据结构、计网、操作系统、组成原理。
- **统一标签体系**：任务、笔记、资源、练功房题目均带科目标签，支持跨模块筛选。
- **进度大盘**：首页展示四大科目整体进度与 408 四门子科目进度。

## 7. 内置浏览器与 B 站视频播放
- 在桌面端内嵌浏览器页签，可直接打开 B 站链接或通过 BV 号播放。
- 与资源站绑定：每条资源可绑定一个视频链接，点击在内置浏览器内播放。

## 4. 总结
通过这种架构，你的所有数据（笔记、PDF、任务）都**完全掌握在自己手中**，无需依赖云端数据库，且能享受本地软件的极速体验。同时，内嵌的 Web 服务完美解决了多端同步（平板复习）的需求，DeepSeek 的接入则赋予了它强大的 AI 大脑。
